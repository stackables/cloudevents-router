# Cloud Events Router

The simplest typed  [cloudevents](https://github.com/cloudevents/sdk-javascript) routing library for nodejs. Library has a single dependency to cloudevents npm library.

## Install

```
npm install cloudevents-router
```

## Define event handlers

```typescript
import { MessagePublishedData } from '@google/events/cloud/pubsub/v1/MessagePublishedData';
import { BuildEventData } from '@google/events/cloud/cloudbuild/v1/BuildEventData';

// This should be generated by the service provider

// example:
// import { GoogleEventsMap } from '@google/events'

// Unfortunately google events library does not have the mapping
// ... so we just create it ourselves

type GoogleEventsMap = {
    'google.cloud.pubsub.topic.v1.messagePublished': MessagePublishedData
    'google.cloud.cloudbuild.build.v1.statusChanged': BuildEventData
}

const router = new CloudEventsRouter<GoogleEventsMap>()

router.on('google.cloud.pubsub.topic.v1.messagePublished', async (event) => {
    console.log('PubSub ordering key', event.data.message?.orderingKey)
})

router.on('google.cloud.cloudbuild.build.v1.statusChanged', async (event) => {
    console.log('Build images array', event.artifacts?.images)
})
```

## Connect to server

Using a middleware

```typescript
import { getMiddleware } from "cloudevents-router"
import http from "http"

const middleware = getMiddleware(router, { path: '/' })
const server = http.createServer(middleware)

server.listen(5000);
```

For express you can use the middleware without configuration

```typescript
import { getMiddleware } from "cloudevents-router"
import express from "express"

const app = express()

app.post('/webhooks', getMiddleware(router))

app.listen(5000)
```

If you are not using a webserver or your framework does not use middleware then you can always manually connect the CloudEventsRouter using the `process()` method. 

See more integration examples at https://github.com/cloudevents/sdk-javascript

```typescript
import { HTTP } from "cloudevents"

const receivedEvent = HTTP.toEvent({ ... });
await router.process(receivedEvent)
```

## Thats it ...

... happy coding :)
